
## 一、代码优化
### 1.1 标签纵表

原来：使用union all 将多次反复调用同一张表，除了代码行数过多外，还造成大量小文件


![[Pasted image 20231015213139.png]]

优化后：优化后代码行数从一千多行减少到100多行，结果文件也大幅减少

![[Pasted image 20231015213736.png]]

![[Pasted image 20231015213532.png]]


### 1.2 每日月累计有消费会员数

由于数据问题，当天需要重跑前一个月的每日月累计有消费会员数

原：使用 ...前天 union all 昨天 union all 今天

优化后：只需要加载一次原表


```sql
1.先按照（月，统计粒度、会员）分区 日期升序排序 as a1
2.基于上面结果a1,按（月、统计粒度）分区 日期升序排序 求和（非1为0） as b1
3.按月期粒度求最大值
日期 会员  a1  b1
01   a     1  1
01   b     1  2
01   c     1  3
02   a     2  3
02   d     1  4
03   a     2  4
```


## 二、程序

### 2.1 统一调度系统项目

分析小组用SAS或Python写的数据分析任务无法运行在大数据平台-数栖或PG平台运行，任务之间又需要相互依赖，更是需要依赖大数据或PG平台的某个任务，偶尔平台报错任务也需要进行重跑。随着分析小组任务的增加，由各自维护已经不切实际，急于开发一套统一调度平台，解决如上难题。

==smartBI页面展示：==

![[2722ea5b8320951ca4b925c933012e7.jpg]]

### 2.2 邮件附件入库

![[f180d187a64cd19198452a9876fd69c.jpg]]
### 2.3 自动邮件

![[06b0d0a8824adb815437cb70a11b5ce.jpg]]